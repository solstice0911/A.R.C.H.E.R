<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A.R.C.H.E.R : OMEGA OVERWATCH v3.0</title>
<style>
/* ================= CORE AESTHETICS ================= */
:root{ 
    --red:#ff004c; --blue:#00aaff; --purple:#8a2be2; --bg:#020105; --green:#00ff41; 
    --glass: rgba(0, 10, 20, 0.9); --dim-purple: rgba(138, 43, 226, 0.2);
}

body, html { margin:0; padding:0; height:100vh; background:var(--bg); color:var(--blue); font-family: 'Consolas', 'Courier New', monospace; overflow: hidden; text-transform: uppercase; user-select: none; }

/* CRT MONITOR FX */
body::after { 
    content: " "; position: fixed; inset: 0; 
    background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%), radial-gradient(circle, transparent 60%, black 150%); 
    z-index: 99999; pointer-events: none; background-size: 100% 3px, 100% 100%; opacity:0.6; 
}
.glitching { animation: shake 0.2s infinite; }
@keyframes shake { 0% { transform: translate(0); } 25% { transform: translate(-2px, 2px); } 50% { transform: translate(2px, -2px); } 75% { transform: translate(-2px, -2px); } 100% { transform: translate(0); } }

/* ================= LOGIN SCREEN ================= */
#login { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 10000; transition: 1s cubic-bezier(0.7,0,0.3,1); }
.login-box { border: 1px solid var(--purple); padding: 50px; width: 400px; background: rgba(0,0,0,0.9); box-shadow: 0 0 50px var(--purple); text-align: center; position:relative; }
.login-box h1 { color:var(--red); letter-spacing:10px; margin:0 0 10px 0; text-shadow:0 0 10px var(--red); }
.login-box input, .login-box button { width: 100%; margin: 10px 0; padding: 15px; background: black; border: 1px solid var(--purple); color: var(--blue); outline: none; font-family: inherit; box-sizing: border-box; }
.login-box button { font-weight:bold; letter-spacing:3px; cursor: pointer; transition:0.3s; }
.login-box button:hover { background: var(--red); color: white; box-shadow: 0 0 20px var(--red); }
#boot-status { height:4px; background:#111; margin-top:10px; width:0%; transition: width 0.1s; }

/* ================= MAIN APP LAYOUT ================= */
#app { display: none; height: 100vh; flex-direction: column; opacity: 0; transition: opacity 2s; }

#top-bar { height: 30px; border-bottom: 1px solid var(--purple); display: flex; align-items: center; font-size: 10px; background: #050010; overflow:hidden; position:relative; }
.ticker { white-space: nowrap; animation: scroll 40s linear infinite; color: var(--red); padding-left: 100%; }
@keyframes scroll { 100% { transform: translateX(-100%); } }
.mute-btn { position:absolute; right:10px; border:1px solid var(--green); color:var(--green); padding:2px 5px; cursor:pointer; z-index:20; background:black; }

.container { flex: 1; display: flex; overflow: hidden; position: relative; }

/* LEFT SIDEBAR */
.side { width: 300px; border-right: 1px solid var(--purple); background: rgba(0,0,0,0.8); display:flex; flex-direction:column; z-index: 10; }
.stats-box { padding:15px; border-bottom:1px solid var(--purple); font-size:10px; line-height:1.6; }
.contact-list { height: 35%; overflow-y: auto; border-bottom: 1px solid var(--purple); }
.contact { padding: 12px; border-bottom: 1px solid #222; font-size: 10px; cursor: pointer; transition:0.2s; }
.contact:hover, .contact.active { background: var(--dim-purple); color: var(--red); border-left: 4px solid var(--red); padding-left:15px; }
#hex-dump { flex: 1; font-size: 9px; color: var(--purple); padding: 10px; overflow: hidden; opacity: 0.7; font-family: monospace; line-height: 1.1; word-break: break-all; background:rgba(10,0,20,0.5); }

/* RIGHT SIDEBAR (TOOLS) */
.side-right { border-left: 1px solid var(--purple); border-right:none; width: 320px; overflow-y: auto; padding: 15px; background:rgba(0,0,0,0.9); z-index:10; }
.tool-cat { color:var(--purple); border-bottom:1px solid #333; margin:15px 0 5px 0; font-size:10px; letter-spacing:2px; }
.tool-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
.tool-btn { border: 1px solid var(--purple); padding: 10px; font-size: 9px; text-align: center; cursor: pointer; background: rgba(0,0,0,0.5); transition: 0.2s; }
.tool-btn:hover { background: var(--blue); color: black; box-shadow: 0 0 10px var(--blue); transform:scale(1.02); }
.danger-btn { border-color: var(--red); color: var(--red); }
.danger-btn:hover { background: var(--red); color: white; }

/* CENTER STAGE & WINDOWS */
.center { flex: 1; position: relative; display: flex; flex-direction: column; background: #000; overflow:hidden; }
.map-overlay { position: absolute; inset: 0; opacity: 0.3; pointer-events:none; }
.chat-box { background: rgba(0,0,0,0.6); overflow-y: auto; height:30%; border-bottom:1px solid var(--purple); padding: 20px; z-index: 5; display:flex; flex-direction:column; }

/* HUD OVERLAY */
#hud-layer { position:absolute; inset:0; pointer-events:none; z-index:2; }
.hud-reticle { position: absolute; width: 100px; height: 100px; border: 1px solid rgba(255,0,76,0.3); }
.hud-reticle::before, .hud-reticle::after { content:''; position:absolute; width:10px; height:1px; background:var(--red); }
.hud-reticle::before { top:50%; left:-5px; } .hud-reticle::after { top:50%; right:-5px; }
.hud-corner-text { position:absolute; color:var(--red); font-size:9px; letter-spacing:1px; }

/* DRAGGABLE WINDOWS */
.drag-win { position: absolute; background: var(--glass); border: 1px solid var(--blue); display: flex; flex-direction: column; box-shadow: 0 0 30px rgba(0,170,255,0.15); z-index: 100; min-height: 100px; min-width:150px; backdrop-filter:blur(2px); }
.win-header { background: rgba(0, 170, 255, 0.2); color: var(--blue); padding: 5px 10px; font-size: 10px; font-weight: bold; cursor: move; display: flex; justify-content: space-between; border-bottom:1px solid var(--blue); }
.win-header:hover { background:var(--blue); color:black; }
.win-body { flex: 1; padding: 0; font-size: 10px; color: var(--green); overflow: hidden; position:relative; }
.graph-canvas { width: 100%; height: 100%; display:block; }
.win-input { width:100%; background:transparent; color:var(--green); border:none; border-top:1px solid var(--blue); padding:10px; outline:none; font-family:inherit; }

/* CHAT MESSAGES */
.m { margin-bottom: 12px; max-width: 85%; font-size:12px; line-height:1.4; }
.them { color: var(--blue); border-left:2px solid var(--blue); padding-left:10px; } 
.me { color: var(--red); text-align: right; border-right:2px solid var(--red); padding-right:10px; align-self:flex-end; }
.cursor::after { content: 'â–ˆ'; animation: blink 1s infinite; margin-left:2px; }
@keyframes blink { 50% { opacity:0; } }

/* BOTTOM TERMINAL */
.bottom-terminal { height: 180px; background: #020202; border-top: 2px solid var(--purple); display: flex; flex-direction: column; z-index: 200; }
#log { flex: 1; padding: 10px; font-size: 11px; overflow-y: auto; color: var(--green); font-family: 'Consolas', monospace; }
#cmd-line { display: flex; border-top: 1px solid #333; background: #080808; align-items:center; }
#cmd-input { background: transparent; border: none; padding: 15px; color: var(--blue); width: 100%; outline: none; font-family: inherit; font-size:12px; }

/* RESPONSIVE */
@media (max-width: 900px) {
    .container { flex-direction: column; }
    .side, .side-right { width: 100%; height:auto; max-height:200px; border:none; border-bottom:1px solid var(--purple); }
    .center { height:40vh; }
    .drag-win { transform: scale(0.8); transform-origin: top left; }
}
</style>
</head>
<body>

<div id="login">
    <canvas id="login-matrix" style="position:absolute; inset:0; opacity:0.15;"></canvas>
    <div class="login-box">
        <h1>A.R.C.H.E.R</h1>
        <p style="font-size: 10px; color: var(--purple); letter-spacing: 3px; margin-bottom:20px;">GLOBAL OVERWATCH INITIATIVE v3.0</p>
        <input id="u" placeholder="OPERATOR_ID" autocomplete="off">
        <input id="p" type="password" placeholder="ACCESS_KEY">
        <button onclick="boot()">INITIALIZE LINK</button>
        <div id="boot-status"></div>
    </div>
</div>

<div id="app">
    <div id="top-bar">
        <div class="ticker">
            >>> [CRITICAL] NODE 774 OFFLINE >>> [ALERT] FIREWALL BREACH IN SECTOR 4 >>> [TRACE] UPLINK ESTABLISHED: TOKYO >>> [SYS] KERNEL UPDATE PENDING >>> [WARN] PROXY SEVERED
        </div>
        <div class="mute-btn" onclick="toggleMute()">[MUTE]</div>
    </div>

    <div class="container">
        <div class="side">
            <div class="stats-box">
                OP: <span id="op-name" style="color:var(--red)">UNKNOWN</span><br>
                CPU: <span id="cpu-stat">12%</span> | RAM: <span id="ram-stat">4.2GB</span><br>
                UPLINK: <span id="ping-stat">24ms</span> (ENCRYPTED)
            </div>
            <div class="contact-list" id="contacts"></div>
            <div id="hex-dump"></div>
        </div>

        <div class="center" id="center-stage">
            <canvas id="world-map" class="map-overlay"></canvas>
            
            <div id="hud-layer">
                <div class="hud-reticle" style="top:20%; left:20%;">
                    <div class="hud-corner-text" style="top:-15px; left:0;">TRGT_A</div>
                </div>
                <div class="hud-reticle" style="bottom:30%; right:20%; border-color:rgba(0,170,255,0.3);">
                    <div class="hud-corner-text" style="bottom:-15px; right:0; color:var(--blue);">TRGT_B</div>
                </div>
                <div style="position:absolute; bottom:10px; left:10px; color:var(--purple); font-size:9px;">
                    COORDS: <span id="coords-hud">00.00, 00.00</span> <br> ZOOM: 4x
                </div>
            </div>

            <div class="chat-box" id="chat">
                <div style="margin:auto; opacity:0.3; letter-spacing:5px;">AWAITING SECURE HANDSHAKE...</div>
            </div>

            <div id="window-zone" style="flex:1; position:relative; pointer-events:none;">
                </div>
        </div>

        <div class="side side-right">
            <div style="color:var(--red); font-weight:bold; margin-bottom:10px; border-bottom:2px solid var(--red);">TACTICAL SUITE</div>
            
            <div class="tool-cat">NETWORK ATTACKS</div>
            <div class="tool-grid">
                <div class="tool-btn" onclick="tLog('PORT SCAN: 22, 80, 443 OPEN')">PORT_SCAN</div>
                <div class="tool-btn" onclick="tLog('PACKET INJECTION: 100%')">PACKET_FLOOD</div>
                <div class="tool-btn" onclick="tLog('MITM ATTACK: LISTENING...')">MITM_SNIFF</div>
                <div class="tool-btn" onclick="tLog('DDOS: BOTNET ACTIVATED')">LOIC_STRIKE</div>
            </div>

            <div class="tool-cat">DECRYPTION</div>
            <div class="tool-grid">
                <div class="tool-btn" onclick="bruteForceSim()">BRUTE_FORCE</div>
                <div class="tool-btn" onclick="tLog('HASH CRACKING: MD5... SHA256...')">HASH_CAT</div>
                <div class="tool-btn" onclick="tLog('RAINBOW TABLE: LOADED')">RAINBOW_TBL</div>
                <div class="tool-btn" onclick="tLog('SQL INJECTION: ADMIN TABLE FOUND')">SQL_MAP</div>
            </div>

            <div class="tool-cat">SURVEILLANCE</div>
            <div class="tool-grid">
                <div class="tool-btn" onclick="tLog('GPS TRIANGULATION: LOCKING...')">GPS_TRACE</div>
                <div class="tool-btn" onclick="tLog('AUDIO FEED: RECORDING')">AUDIO_TAP</div>
                <div class="tool-btn" onclick="tLog('KEYLOGGER: INSTALLED')">KEY_LOG</div>
                <div class="tool-btn" onclick="tLog('WEBCAM: ACCESS GRANTED')">CAM_HIJACK</div>
            </div>

            <div class="tool-cat">DANGER ZONE</div>
            <div class="tool-grid">
                <div class="tool-btn danger-btn" onclick="location.reload()">SYSTEM_PURGE</div>
                <div class="tool-btn danger-btn" onclick="selfDestruct()">SELF_DESTRUCT</div>
            </div>
        </div>
    </div>

    <div class="bottom-terminal">
        <div id="log"></div>
        <div id="cmd-line">
            <span style="color:var(--purple); padding:10px 0 10px 15px;">ROOT@ARCHER:~#</span>
            <input id="cmd-input" placeholder="ENTER COMMAND (Try 'help' or 'nuke')..." autocomplete="off">
        </div>
    </div>
</div>

<script>
/* ================= ENGINE CORE ================= */
const audio = new (window.AudioContext || window.webkitAudioContext)();
let isMuted = false;
let zIndexCounter = 100;

function toggleMute() { isMuted = !isMuted; }

function beep(f, d, t='square') { 
    if(isMuted) return;
    if(audio.state === 'suspended') audio.resume();
    const o = audio.createOscillator(); const g = audio.createGain(); 
    o.type = t; o.frequency.value = f; g.gain.setValueAtTime(0.015, audio.currentTime); 
    o.connect(g); g.connect(audio.destination); o.start(); o.stop(audio.currentTime + d); 
}

/* ================= BOOT SEQUENCE ================= */
function boot() {
    // 1. Get the values typed by the user
    const user = document.getElementById('u').value;
    const pass = document.getElementById('p').value;
    const stat = document.getElementById('boot-status');

    // 2. Check if they match your specific credentials
    if (user === "Solstice" && pass === "091107") {
        
        // --- SUCCESS SEQUENCE ---
        beep(400, 0.1); // Success beep
        document.getElementById('op-name').textContent = user.toUpperCase(); // Set name on HUD
        
        // Start the loading bar animation
        let p = 0;
        const iv = setInterval(() => {
            p += 2; 
            stat.textContent = "DECRYPTING... " + p + "%";
            stat.style.width = p + "%"; 
            stat.style.backgroundColor = p > 80 ? "var(--green)" : "var(--red)";
            if(p >= 100) { clearInterval(iv); startSystem(); }
        }, 30);

    } else {
        
        // --- FAILURE SEQUENCE ---
        beep(150, 0.4, 'sawtooth'); // Low error buzz
        stat.style.width = "100%";
        stat.style.backgroundColor = "var(--red)";
        stat.textContent = "ACCESS DENIED // INVALID KEY";
        stat.style.color = "black";
        stat.style.fontWeight = "bold";

        // Reset the error message after 1.5 seconds
        setTimeout(() => {
            stat.style.width = "0%";
            stat.textContent = "";
        }, 1500);
    }
}

function startSystem() {
    document.getElementById('login').style.transform = "translateY(-100vh)";
    document.getElementById('app').style.display = 'flex';
    setTimeout(() => { document.getElementById('app').style.opacity = '1'; }, 100);
    
    tLog("SYSTEM ONLINE.");
    tLog("CONNECTING TO GLOBAL NODE MESH...");
    
    initWorldMap();
    initHexDump();
    renderContacts();
    
    // SPAWN DEFAULT WINDOWS
    spawnWindow('NETWORK_TOPOLOGY', 300, 200, 50, 50, drawNetGraph);
    spawnWindow('AUDIO_SPECTRUM', 300, 150, 400, 50, drawSpectrum);
    spawnWindow('DECRYPTION_CORE', 200, 250, 50, 300, drawMatrix);
    
    // Spawn AI Terminal
    spawnWindow('AI_ASSISTANT', 250, 200, 400, 250, null, true);
}

/* ================= WINDOW MANAGER ================= */
function spawnWindow(title, w, h, x, y, drawFn, isAI=false) {
    const zone = document.getElementById('window-zone');
    const id = 'win-' + Math.floor(Math.random()*100000);
    
    const div = document.createElement('div');
    div.className = 'drag-win';
    div.style.width = w + 'px'; div.style.height = h + 'px';
    div.style.left = x + 'px'; div.style.top = y + 'px';
    div.style.pointerEvents = "auto"; // Enable interaction
    
    let contentHTML = `<canvas id="c-${id}" class="graph-canvas"></canvas>`;
    if(isAI) {
        contentHTML = `
            <div id="ai-log" style="flex:1; padding:10px; overflow-y:auto; color:var(--green);">AI: Ready.</div>
            <input class="win-input" id="ai-in-${id}" placeholder="QUERY DATABASE..." onkeydown="handleAI(event, this, 'ai-log')">
        `;
    }

    div.innerHTML = `
        <div class="win-header" onmousedown="dragStart(event, this.parentNode)">
            <span>${title}</span>
            <span style="cursor:pointer;" onclick="this.parentNode.parentNode.remove()">[X]</span>
        </div>
        <div class="win-body">${contentHTML}</div>
    `;
    
    zone.appendChild(div);
    
    if(drawFn) {
        const cvs = document.getElementById(`c-${id}`);
        cvs.width = cvs.offsetWidth; cvs.height = cvs.offsetHeight;
        drawFn(cvs, cvs.getContext('2d'));
    }
}

function dragStart(e, el) {
    zIndexCounter++; el.style.zIndex = zIndexCounter;
    // Get initial cursor position relative to window
    let shiftX = e.clientX - el.getBoundingClientRect().left;
    let shiftY = e.clientY - el.getBoundingClientRect().top;
    
    // Get container bounds to calculate relative position
    const container = document.getElementById('center-stage');
    const bounds = container.getBoundingClientRect();

    function moveAt(pageX, pageY) {
        // Calculate new Left/Top relative to the container
        let newLeft = pageX - shiftX - bounds.left;
        let newTop = pageY - shiftY - bounds.top;
        
        el.style.left = newLeft + 'px';
        el.style.top = newTop + 'px';
    }

    function onMouseMove(event) { moveAt(event.pageX, event.pageY); }

    document.addEventListener('mousemove', onMouseMove);
    document.onmouseup = function() {
        document.removeEventListener('mousemove', onMouseMove);
        document.onmouseup = null;
    };
}

/* ================= VISUALIZATIONS ================= */
function drawNetGraph(c, ctx) {
    let nodes = [];
    for(let i=0; i<10; i++) nodes.push({x:Math.random()*c.width, y:Math.random()*c.height, vx:(Math.random()-0.5), vy:(Math.random()-0.5)});
    function anim() {
        if(!c.isConnected) return; // Stop if removed
        ctx.fillStyle="rgba(0,10,20,0.3)"; ctx.fillRect(0,0,c.width,c.height);
        ctx.strokeStyle="rgba(0,170,255,0.3)"; ctx.fillStyle="var(--blue)";
        nodes.forEach((n, i) => {
            n.x+=n.vx; n.y+=n.vy;
            if(n.x<0||n.x>c.width) n.vx*=-1; if(n.y<0||n.y>c.height) n.vy*=-1;
            ctx.beginPath(); ctx.arc(n.x,n.y,2,0,Math.PI*2); ctx.fill();
            nodes.forEach((n2,j)=>{
                if(i!==j && Math.hypot(n.x-n2.x,n.y-n2.y)<60) {
                    ctx.beginPath(); ctx.moveTo(n.x,n.y); ctx.lineTo(n2.x,n2.y); ctx.stroke();
                }
            });
        });
        requestAnimationFrame(anim);
    }
    anim();
}

function drawSpectrum(c, ctx) {
    let bars=20; let w=c.width/bars;
    function anim() {
        if(!c.isConnected) return;
        ctx.clearRect(0,0,c.width,c.height);
        ctx.fillStyle="rgba(138,43,226,0.8)";
        for(let i=0;i<bars;i++) {
            let h = Math.random()*c.height*0.8;
            ctx.fillRect(i*w, c.height-h, w-2, h);
        }
        requestAnimationFrame(anim);
    }
    anim();
}

function drawMatrix(c, ctx) {
    let cols = Math.floor(c.width/10);
    let y = Array(cols).fill(0);
    function anim() {
        if(!c.isConnected) return;
        ctx.fillStyle="rgba(0,0,0,0.1)"; ctx.fillRect(0,0,c.width,c.height);
        ctx.fillStyle="#0f0"; ctx.font="10px monospace";
        y.forEach((pos, i) => {
            let char = String.fromCharCode(0x30A0 + Math.random()*96);
            ctx.fillText(char, i*10, pos);
            if(pos > c.height && Math.random()>0.975) y[i]=0;
            y[i]+=10;
        });
        requestAnimationFrame(anim);
    }
    anim();
}

/* ================= DATA FEEDS ================= */
function initHexDump() {
    const d = document.getElementById('hex-dump');
    setInterval(() => {
        let l = "0x" + Math.floor(Math.random()*65535).toString(16).toUpperCase().padStart(4,'0') + " : ";
        for(let i=0; i<4; i++) l += Math.floor(Math.random()*255).toString(16).toUpperCase().padStart(2,'0') + " ";
        let r = document.createElement('div'); r.innerText = l;
        d.appendChild(r);
        if(d.children.length > 20) d.removeChild(d.firstChild);
        d.scrollTop = d.scrollHeight;
    }, 100);

    // Update Stats
    setInterval(() => {
        document.getElementById('cpu-stat').innerText = Math.floor(Math.random()*30+10) + "%";
        document.getElementById('ram-stat').innerText = (Math.random()*2 + 3).toFixed(1) + "GB";
        document.getElementById('ping-stat').innerText = Math.floor(Math.random()*40+10) + "ms";
        document.getElementById('coords-hud').innerText = (Math.random()*100).toFixed(4) + ", " + (Math.random()*100).toFixed(4);
    }, 1000);
}

function initWorldMap() {
    const c = document.getElementById('world-map');
    const ctx = c.getContext('2d');
    c.width = c.offsetWidth; c.height = c.offsetHeight;
    let sat = 0;
    function anim() {
        ctx.clearRect(0,0,c.width,c.height);
        // Grid
        ctx.strokeStyle="rgba(0,170,255,0.1)"; ctx.lineWidth=1;
        for(let i=0; i<c.width; i+=50) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,c.height); ctx.stroke(); }
        for(let i=0; i<c.height; i+=50) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(c.width,i); ctx.stroke(); }
        
        // Random Blips
        if(Math.random()>0.9) {
            ctx.fillStyle="rgba(255,0,76,0.8)";
            ctx.beginPath(); ctx.arc(Math.random()*c.width, Math.random()*c.height, 3, 0, Math.PI*2); ctx.fill();
        }

        // Satellite
        sat += 0.02;
        let sx = c.width/2 + Math.cos(sat)*100;
        let sy = c.height/2 + Math.sin(sat)*100;
        ctx.strokeStyle="var(--red)"; ctx.beginPath(); ctx.arc(sx, sy, 5, 0, Math.PI*2); ctx.stroke();
        
        requestAnimationFrame(anim);
    }
    anim();
}

/* ================= CHAT SYSTEM ================= */
const contacts = {
    "TW1L1GHT": ["Did you clear the logs?", "Yes. The encryption is holding.", "Good. The payload is 90% uploaded.", "Watch out for the ICE protocols."],
    "J0VE": ["Sector 7 is dark.", "I know. Rerouting power.", "Hurry, they are tracing the signal.", "Done. Backdoor established."],
    "NIGHTSHADE": ["Got the hardware specs?", "Sent. Check encrypted drive.", "This processor is illegal.", "That's why it costs triple."]
};
let typing = false;

function renderContacts() {
    const l = document.getElementById('contacts');
    Object.keys(contacts).forEach(n => {
        let d = document.createElement('div'); d.className = 'contact';
        d.innerText = "[LINK] " + n;
        d.onclick = () => loadChat(n, d);
        l.appendChild(d);
    });
}

function loadChat(name, el) {
    document.querySelectorAll('.contact').forEach(c=>c.classList.remove('active'));
    el.classList.add('active');
    const box = document.getElementById('chat');
    box.innerHTML = `<div style="text-align:center; color:var(--purple); margin-bottom:10px;">--- SECURE CONNECTION: ${name} ---</div>`;
    
    let msgs = contacts[name];
    let i = 0;
    function next() {
        if(i >= msgs.length) return;
        let div = document.createElement('div');
        div.className = "m " + (i%2 ? "me" : "them") + " cursor";
        box.appendChild(div);
        typeText(div, (i%2?"ME: ":"") + msgs[i], 0, () => {
            div.classList.remove("cursor");
            i++;
            box.scrollTop = box.scrollHeight;
            setTimeout(next, 800);
        });
    }
    next();
}

function typeText(el, txt, idx, cb) {
    if(idx < txt.length) {
        el.innerText += txt.charAt(idx);
        beep(800, 0.03);
        setTimeout(() => typeText(el, txt, idx+1, cb), Math.random()*30+20);
    } else cb();
}

/* ================= AI & TOOLS ================= */
function handleAI(e, input, logId) {
    if(e.key === 'Enter') {
        const val = input.value;
        const log = document.getElementById(logId);
        log.innerHTML += `<div>> ${val}</div>`;
        input.value = "";
        setTimeout(() => {
            let reply = "PROCESSING...";
            if(val.includes('status')) reply = "SYSTEM INTEGRITY: 98%.";
            else if(val.includes('trace')) reply = "TRACING ROUTE... 127.0.0.1";
            else reply = "COMMAND UNKNOWN. SEARCHING DATABASE...";
            log.innerHTML += `<div style="color:var(--blue)">AI: ${reply}</div>`;
            log.scrollTop = log.scrollHeight;
        }, 500);
    }
}

function tLog(msg, type='info') {
    const l = document.getElementById('log');
    const d = document.createElement('div');
    d.innerHTML = `<span style="color:#555">[${new Date().toLocaleTimeString()}]</span> <span style="color:${type==='error'?'var(--red)':'var(--green)'}">${msg}</span>`;
    l.appendChild(d);
    l.scrollTop = l.scrollHeight;
}

function bruteForceSim() {
    tLog("INITIATING BRUTE FORCE...", "error");
    let iv = setInterval(() => {
        let pass = Math.random().toString(36).slice(-8).toUpperCase();
        tLog(`TRYING: ${pass} ... FAIL`, "error");
        if(Math.random() > 0.9) {
            clearInterval(iv);
            tLog(`ACCESS GRANTED. PASS: GHOST_99`, "success");
            beep(600, 0.5);
        }
    }, 100);
}

function selfDestruct() {
    document.body.innerHTML = "<h1 style='color:red; margin-top:20%; text-align:center; font-size:50px; letter-spacing:10px;'>SIGNAL LOST</h1>";
    audio.close();
}

/* ================= TERMINAL COMMANDS ================= */
document.getElementById('cmd-input').addEventListener('keydown', function(e) {
    if(e.key === 'Enter') {
        let cmd = this.value.toLowerCase().trim();
        this.value = "";
        tLog("COMMAND: " + cmd);
        if(cmd === 'nuke') {
            tLog("WARNING: NUCLEAR LAUNCH DETECTED!", "error");
            document.body.style.animation = "shake 0.1s infinite";
            document.body.style.filter = "invert(1)";
            setTimeout(() => { document.body.style.animation=""; document.body.style.filter="none"; tLog("SIMULATION RESET."); }, 3000);
        } else if(cmd === 'clear') {
            document.getElementById('log').innerHTML = "";
        } else if(cmd === 'help') {
            tLog("CMDS: CLEAR, NUKE, STATUS, EXIT");
        }
    }
});

/* ================= MATRIX BACKGROUND ================= */
const lCan = document.getElementById('login-matrix'); 
const lCtx = lCan.getContext('2d');
lCan.width = window.innerWidth; lCan.height = window.innerHeight;
function matrixBG() {
    lCtx.fillStyle = "rgba(0,0,0,0.05)"; lCtx.fillRect(0,0,lCan.width,lCan.height);
    lCtx.fillStyle = "#8a2be2";
    for(let i=0; i<30; i++) lCtx.fillText(Math.random()>.5?"1":"0", Math.random()*lCan.width, Math.random()*lCan.height);
    requestAnimationFrame(matrixBG);
}
matrixBG();

</script>
</body>
</html>


